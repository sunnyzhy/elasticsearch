# Geography
## 基本知识
1. 经度: 英文 longitude，缩写 lng 或 lon

   纬度：英文 latitude，缩写 lat

2. 本初子午线也称 0° 经线，东经度的最大值为 180°，西经度的最大值为 180°，东、西经 180° 经线是同一根经线，因此不分东经或西经，而统称 180° 经线。

   赤道是 0° 纬线，北纬度的最大值为 90°，即北极点；南纬度的最大值为 90°，即南极点。

3. 经度是一个两面角，是两个经线平面的夹角。

   纬度是一个线面角，是该点的法线与赤道平面之间的夹角。

4. 东经为正数，西经为负数。

   北纬为正数，南纬为负数。

5. 经纬度的范围: 

   经度[-180,180]
   
   纬度[-90,90]

6. **把地球看作是正球**，以 WGS84 坐标系为例，地球半径是 6378137m，那么:

   赤道周长 = 2 * π * 6378137 = 40,075,016.0019724
   
   又因为赤道被分为了 360 度，所以一度就是
   
   40,075,016.0019724 / 360 = 111,319.4888943678m ≈ 111km

7. 同一经线上，纬度差 1°，经线长约为 111km

   同一纬线上，经度差1°，纬线长约为 111km * cosα，因为赤道的纬度值为 0，cosα = 1，所以 111km * 1 = 111km

8. 经纬度 1 度 = 60 分 = 3600 秒

   纬度 1 度 ≈ 111km
   
   纬度 1 分 ≈ 111km / 60 = 1.85km
   
   纬度 1 秒 ≈ 111km / 3600 ≈ 30.8m

## ES 的地图检索方式
### geo_bounding_box

geo_bounding_box: 以两个点，确定一个矩形，获取矩形内的全部地理坐标。

查询的结构体:

```json
GET /<index>/_search
{
	"query": {
		"bool": {
			"filter": {
				"geo_bounding_box": {
					"FIELD": {
						"top_left": {
							"lat": 40.73,
							"lon": -74.1
						},
						"bottom_right": {
							"lat": 40.717,
							"lon": -73.99
						}
					}
				}
			}
		}
	}
}
```

参数说明:
- FIELD: 自定义的地理位置字段
- top_left: 左上点的坐标
- bottom_right: 右下点的坐标

### geo_distance

geo_distance: 以一个点和一个半径，确定一个圆形，获取圆形内的全部地理坐标。

查询的结构体:

```json
GET /<index>/_search
{
	"query": {
		"bool": {
			"filter": {
				"geo_distance": {
					"distance": "200km",
					"distance_type": "arc",
					"FIELD": {
						"lat": 40.73,
						"lon": -74.1
					}
				}
			}
		}
	}
}
```

参数说明:
- FIELD: 自定义的地理位置字段
- distance: 半径，单位默认是 m
- distance_type: 图形的类型，默认是圆形 arc

### geo_polygon

geo_polygon: 以多个点，确定一个多边形，获取多边形内的全部地理坐标。

查询的结构体:

```json
GET /<index>/_search
{
	"query": {
		"bool": {
			"filter": {
				"geo_polygon": {
					"FIELD": {
						"points": [{
								"lat": 40,
								"lon": -70
							},
							{
								"lat": 30,
								"lon": -80
							},
							{
								"lat": 20,
								"lon": -90
							}
						]
					}
				}
			}
		}
	}
}
```

参数说明:
- FIELD: 自定义的地理位置字段
- points: 数组，存储多点的坐标，数组的元素个数必须 >= 3
